import{B as T}from"./Authenticated-89c7332d.js";import{H as I,L as U}from"./@inertiajs-2b766590.js";import{h as $}from"./moment-a9aaa855.js";import{_ as k}from"./Card-b75ae06b.js";import{_ as L}from"./DialogModal-6d0aecd6.js";import{_ as Y}from"./Collapsible-08c65aae.js";import{_ as C,d as w,e as i,c as p,a as F,b as _}from"./TableRow-da22b5e6.js";import{_ as N}from"./TableCaption-43844f83.js";import{_ as R}from"./index-82c7be52.js";import{C as S}from"./lucide-vue-next-7b48dc26.js";import{x as V,v as t,u as o,O as e,F as D,b7 as b,q as f,U as l,y as n,I as B,t as v,J as u,B as A,m as j}from"./@vue-39dc9ff3.js";import"./ApplicationLogo-5cf6e77e.js";import"./radix-vue-a603168c.js";import"./@floating-ui-c05b1c1f.js";import"./@internationalized-2f03b566.js";import"./class-variance-authority-52f2569e.js";import"./clsx-1229b3e0.js";import"./app-dbb80022.js";import"./axios-1779699b.js";import"./pusher-js-68b5c933.js";import"./@vueform-8fb84cf1.js";import"./@vuepic-a83e4355.js";import"./@babel-1b80a44a.js";import"./cropperjs-042b647f.js";import"./laravel-vite-plugin-d10ca5e8.js";import"./vue-debounce-ed417ae1.js";import"./v-calendar-e9930861.js";import"./tailwind-merge-3f7ff3b1.js";import"./@vueuse-c14271ca.js";import"./@radix-icons-9ff33614.js";import"./lodash.isequal-0acc53e7.js";import"./vue-46d666fa.js";import"./lodash.clonedeep-12c784b4.js";import"./qs-45a3326f.js";import"./side-channel-401220dd.js";import"./get-intrinsic-88feedc6.js";import"./es-errors-82fd953f.js";import"./has-symbols-e8f3ca0e.js";import"./has-proto-1353c55e.js";import"./function-bind-61637ca6.js";import"./hasown-bc561cf0.js";import"./call-bind-9ec8ebd8.js";import"./set-function-length-ecd19468.js";import"./define-data-property-d38573ea.js";import"./es-define-property-cfa03815.js";import"./gopd-4c4454f6.js";import"./has-property-descriptors-68e2873e.js";import"./object-inspect-ac0241aa.js";import"./deepmerge-89e33937.js";import"./nprogress-87ee1729.js";const E={class:"grid grid-cols-1 xl:grid-cols-2 2xl:grid-cols-4 gap-4"},O=n("span",{class:"text-red-500"},"*",-1),H=n("span",{class:"text-red-500"},"*",-1),z=n("span",{class:"text-red-500"},"*",-1),J=n("span",{class:"text-red-500"},"*",-1),W={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},q={class:"w-full"},G={class:"flex flex-col justify-end items-end"},K={class:"grid grid-cols-1 xl:grid-cols-2 gap-2"},Q={class:"flex justify-between items-center"},X=n("span",{class:"ml-1 hidden sm:block"},"Add",-1),Z={class:"min-h-[18px] inline-flex justify-center items-center px-1 bg-gray-200 border border-transparent font-mono text-gray-800 rounded-md"},ee=["href"],te={class:"flex items-center justify-end"},ae={class:"flex space-x-2"},oe={class:"p-1 grid grid-cols-1 gap-4"},le={class:"relative"},re=n("span",{class:"text-xs text-indigo-500"},"PDF, JPEG",-1),se={class:"mt-1 items-center w-full"},ne={class:""},ie={class:"block focus:ring-0 focus:border-gray-300"},de=n("span",{class:"sr-only"},"Browse File",-1),ue={components:{Head:I,Link:U,Card:k,Dialog:L,Table:C,TableBody:w,TableCaption:N,TableCell:i,TableHead:p,TableHeader:F,TableRow:_},data(){return{collapsible_is_open:!0,date_issued:$(this.$page.props.invoice_data.date_issued).format("DD MMM Y"),due_date:$(this.$page.props.invoice_data.due_date).format("DD MMM Y"),show:{add_attachment:!1},form:{params:this.$page.props.params,invoice_id:this.$page.props.invoice_data.id,invoice_items:JSON.parse(this.$page.props.invoice_data.invoice_items),invoice_amount:this.$page.props.invoice_data.amount,payment:{status:this.$page.props.invoice_data.status,proofs:[],proofs_to_delete:[]}},attachment:{date:"",transaction_id:"",url:"",file:"",remark:""},errors:{date:!1,transaction_id:!1,proof_of_payment:!1}}},watch:{"form.invoice_items":{handler(m){m.forEach(a=>{a.programme_fee||(a.programme_fee=0),a.programme_fee_discount||(a.programme_fee_discount=0),a.registration_fee||(a.registration_fee=0),a.registration_fee_discount||(a.registration_fee_discount=0),a.material_fee||(a.material_fee=0),a.material_fee_discount||(a.material_fee_discount=0)})},deep:!0}},methods:{submit(){this.form.invoice_amount=this.totalFee(this.form.invoice_items),this.$inertia.post(route("fee.invoices.update"),this.form,{preserveState:!0})},totalFee(m){let a=0;for(const d of m){const h=parseFloat(d.programme_fee),P=parseFloat(d.programme_fee_discount),c=parseFloat(d.registration_fee),x=parseFloat(d.registration_fee_discount),M=parseFloat(d.material_fee),r=parseFloat(d.material_fee_discount);a+=h-P,d.include_registration_fee&&(a+=c-x),d.include_material_fee&&(a+=M-r);var s=0;if(d.promos&&Array.isArray(d.promos)){for(const g of d.promos)g.type_id===1&&(s+=h*g.value/100),g.type_id===2&&(s+=g.value);a=a-s}}return a},clearErrors(){this.errors.date=!1,this.errors.transaction_id=!1,this.errors.proof_of_payment=!1},clearAttachmentFields(){this.attachment.date="",this.attachment.transaction_id="",this.attachment.url="",this.attachment.file="",this.attachment.remark=""},showModal(){this.clearErrors(),this.clearAttachmentFields(),this.show.add_attachment=!0},deleteProof(m,a){this.form.payment.proofs.splice(m,1),a&&this.form.payment.proofs_to_delete.push(a)},uploadFile(m){const a=m.target.files[0];a.type=="application/pdf"||a.name.toLowerCase().endsWith(".pdf")||a.type=="image/jpeg"||a.name.toLowerCase().endsWith(".png")?(this.attachment.url=URL.createObjectURL(a),this.attachment.file=a):(alert("Only Image / PDF File allowed!"),this.$refs.file_input.value="")},addAttachment(){if(!this.attachment.date||!this.attachment.transaction_id||!this.attachment.file){this.errors.date=!this.attachment.date,this.errors.transaction_id=!this.attachment.transaction_id,this.errors.proof_of_payment=!this.attachment.file;return}this.form.payment.proofs.push({date:$(this.attachment.date).format("DD-MM-YYYY"),transaction_id:this.attachment.transaction_id,url:this.attachment.url,file:this.attachment.file,remark:this.attachment.remark}),this.show_add_attachment=!1},openPaymentLink(){window.open(this.$page.props.bill_info.url,"_blank")}},mounted(){this.$page.props.invoice_attachments.forEach(m=>{this.form.payment.proofs.push({id:m.id,date:$(m.date).format("DD-MM-YYYY"),transaction_id:m.transaction_id,url:m.attachment,file:"",remark:m.remark})})}},nt=Object.assign(ue,{__name:"Edit",setup(m){return(a,s)=>{const d=b("Label"),h=b("Input"),P=b("ComboBox"),c=b("Button"),x=b("Datepicker"),M=b("Textarea");return f(),V(D,null,[t(o(I),{title:"Fee Invoices"}),t(T,null,{header:e(()=>[]),default:e(()=>[t(k,null,{title:e(()=>[l("Invoice Information")]),content:e(()=>[n("div",E,[n("div",null,[t(d,null,{default:e(()=>[l("Invoice Number"),O]),_:1}),t(h,{type:"text",error:!!a.$page.props.errors.invoice_number,modelValue:a.$page.props.invoice_data.invoice_number,"onUpdate:modelValue":s[0]||(s[0]=r=>a.$page.props.invoice_data.invoice_number=r),disabled:""},null,8,["error","modelValue"])]),n("div",null,[t(d,null,{default:e(()=>[l("Student Name"),H]),_:1}),t(h,{type:"text",error:!!a.$page.props.errors.student_name,modelValue:a.$page.props.invoice_data.student_name,"onUpdate:modelValue":s[1]||(s[1]=r=>a.$page.props.invoice_data.student_name=r),disabled:""},null,8,["error","modelValue"])]),n("div",null,[t(d,null,{default:e(()=>[l("Date Issued"),z]),_:1}),t(h,{type:"text",error:!!a.$page.props.errors.date_issued,modelValue:a.$page.props.invoice_data.date_issued,"onUpdate:modelValue":s[2]||(s[2]=r=>a.$page.props.invoice_data.date_issued=r),disabled:""},null,8,["error","modelValue"])]),n("div",null,[t(d,null,{default:e(()=>[l("Due Date"),J]),_:1}),t(h,{type:"text",error:!!a.$page.props.errors.due_date,modelValue:a.$page.props.invoice_data.due_date,"onUpdate:modelValue":s[3]||(s[3]=r=>a.$page.props.invoice_data.due_date=r),disabled:""},null,8,["error","modelValue"])])])]),_:1}),t(k,null,{title:e(()=>[l("Programme Information")]),content:e(()=>[(f(!0),V(D,null,B(a.form.invoice_items,(r,g)=>(f(),v(Y,{modelValue:a.collapsible_is_open,"onUpdate:modelValue":s[4]||(s[4]=y=>a.collapsible_is_open=y)},{trigger:e(()=>[l(u(r.programme_name)+" ( Level "+u(r.programme_level)+" )",1)]),content:e(()=>[t(o(C),{class:"px-4"},{default:e(()=>[t(o(F),{class:"bg-gray-100"},{default:e(()=>[t(o(_),null,{default:e(()=>[t(o(p),null,{default:e(()=>[l("Items")]),_:1}),t(o(p),null,{default:e(()=>[l("Discount")]),_:1}),t(o(p),null,{default:e(()=>[l("Amount")]),_:1})]),_:1})]),_:1}),t(o(w),null,{default:e(()=>[t(o(_),null,{default:e(()=>[t(o(i),null,{default:e(()=>[l(u(r.programme_type),1)]),_:2},1024),t(o(i),null,{default:e(()=>[l(u(r.programme_fee_discount),1)]),_:2},1024),t(o(i),null,{default:e(()=>[l(u(r.use_old_fee?r.old_programme_fee:r.programme_fee),1)]),_:2},1024)]),_:2},1024),r.include_registration_fee&&r.registration_fee!=0?(f(),v(o(_),{key:0},{default:e(()=>[t(o(i),null,{default:e(()=>[l("Registration Fee")]),_:1}),t(o(i),null,{default:e(()=>[l(u(r.registration_fee_discount),1)]),_:2},1024),t(o(i),null,{default:e(()=>[l(u(r.registration_fee),1)]),_:2},1024)]),_:2},1024)):A("",!0),r.include_material_fee?(f(),v(o(_),{key:1},{default:e(()=>[t(o(i),null,{default:e(()=>[l("Material Fee")]),_:1}),t(o(i),null,{default:e(()=>[l(u(r.material_fee_discount),1)]),_:2},1024),t(o(i),null,{default:e(()=>[l(u(r.material_fee),1)]),_:2},1024)]),_:2},1024)):A("",!0),r.promos?(f(!0),V(D,{key:2},B(r.promos,y=>(f(),v(o(_),null,{default:e(()=>[t(o(i),{class:"space-x-2"},{default:e(()=>[n("span",null,u(y.promo_name),1),t(o(R),{variant:""},{default:e(()=>[l("Promo")]),_:1})]),_:2},1024),t(o(i),null,{default:e(()=>[l(u(y.type_id===1?r.programme_fee*y.value/100:y.value),1)]),_:2},1024),t(o(i),null,{default:e(()=>[l("0")]),_:1})]),_:2},1024))),256)):A("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"]))),256)),n("div",W,[n("div",q,[t(d,{for:"payment_status"},{default:e(()=>[l(" Payment Status ")]),_:1}),t(P,{id:"payment_status",items:a.$page.props.invoice_status,"label-property":"name","value-property":"id",error:a.$page.props.errors.status,modelValue:a.form.payment.status,"onUpdate:modelValue":s[5]||(s[5]=r=>a.form.payment.status=r),"select-placeholder":"Select Status","search-placeholder":"Search status..."},null,8,["items","error","modelValue"])]),n("div",G,[t(d,{class:"text-md font-medium"},{default:e(()=>[l(" Total Amount")]),_:1}),t(d,{class:"text-xl font-bold"},{default:e(()=>[l(u(a.$page.props.invoice_data.amount),1)]),_:1})])])]),_:1}),n("div",K,[t(k,null,{title:e(()=>[l("Online Payment (Billplz)")]),content:e(()=>[t(o(C),{class:"px-4"},{default:e(()=>[t(o(F),{class:"bg-gray-100"},{default:e(()=>[t(o(_),null,{default:e(()=>[t(o(p),{class:"px-4"},{default:e(()=>[l("Payment Date")]),_:1}),t(o(p),null,{default:e(()=>[l("Email")]),_:1}),t(o(p),null,{default:e(()=>[l("Receipt")]),_:1})]),_:1})]),_:1}),t(o(w),null,{default:e(()=>[a.$page.props.bill_info.paid?(f(),v(o(_),{key:0},{default:e(()=>[t(o(i),{class:"px-4"},{default:e(()=>[l(u(o($)(a.$page.props.bill_info.paid_at).format("DD/MM/Y")),1)]),_:1}),t(o(i),null,{default:e(()=>[l(u(a.$page.props.bill_info.email),1)]),_:1}),t(o(i),null,{default:e(()=>[t(c,{onClick:s[6]||(s[6]=r=>a.openPaymentLink())},{default:e(()=>[l("View")]),_:1})]),_:1})]),_:1})):(f(),v(o(_),{key:1},{default:e(()=>[t(o(i),{class:"text-center",colspan:"3"},{default:e(()=>[l("No Records")]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),t(k,null,{title:e(()=>[n("div",Q,[l(" Proof of Payment "),t(c,{onClick:a.showModal},{default:e(()=>[t(o(S),{class:"h-4 w-4"}),X]),_:1},8,["onClick"])])]),content:e(()=>[t(o(C),{class:"px-4"},{default:e(()=>[t(o(F),{class:"bg-gray-100"},{default:e(()=>[t(o(_),null,{default:e(()=>[t(o(p),null,{default:e(()=>[l("#")]),_:1}),t(o(p),null,{default:e(()=>[l("Date")]),_:1}),t(o(p),null,{default:e(()=>[l("Transaction ID")]),_:1}),t(o(p),null,{default:e(()=>[l("File Name")]),_:1}),t(o(p),null,{default:e(()=>[l("Remark")]),_:1}),t(o(p),{class:"text-center"},{default:e(()=>[l("Action")]),_:1})]),_:1})]),_:1}),t(o(w),null,{default:e(()=>[a.form.payment.proofs.length?(f(!0),V(D,{key:0},B(a.form.payment.proofs,(r,g)=>(f(),v(o(_),null,{default:e(()=>[t(o(i),null,{default:e(()=>[l(u(g+1),1)]),_:2},1024),t(o(i),null,{default:e(()=>[l(u(r.date),1)]),_:2},1024),t(o(i),null,{default:e(()=>[n("kbd",Z,u(r.transaction_id),1)]),_:2},1024),t(o(i),null,{default:e(()=>[n("a",{href:r.file?r.url:"/storage/proof_of_payment/"+r.url,download:"",class:"min-h-[30px] inline-flex justify-center items-center py-1 px-1.5 bg-white border border-gray-200 font-mono text-sm text-gray-800 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:bg-neutral-900"},u(r.file?r.file.name:r.url),9,ee)]),_:2},1024),t(o(i),null,{default:e(()=>[l(u(r.remark),1)]),_:2},1024),t(o(i),{class:"text-center"},{default:e(()=>[t(c,{variant:"destructive",onClick:y=>a.deleteProof(g,r.id)},{default:e(()=>[l("Delete")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),256)):(f(),v(o(_),{key:1},{default:e(()=>[t(o(i),{class:"text-center",colspan:"10"},{default:e(()=>[l("No Records")]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})]),t(k,null,{content:e(()=>[n("div",te,[n("div",ae,[t(c,{variant:"outline",onClick:s[7]||(s[7]=r=>a.$inertia.get(a.route("fee.invoices",a.$page.props.params)))},{default:e(()=>[l("Cancel")]),_:1}),t(c,{onClick:a.submit},{default:e(()=>[l("Save")]),_:1},8,["onClick"])])])]),_:1}),t(L,{open:a.show.add_attachment,"onUpdate:open":s[13]||(s[13]=r=>a.show.add_attachment=r)},{title:e(()=>[l("Add Proof of Payment")]),content:e(()=>[n("div",oe,[n("div",le,[t(d,{id:"date"},{default:e(()=>[l("Date")]),_:1}),t(x,{mode:"date",modelValue:a.attachment.date,"onUpdate:modelValue":s[8]||(s[8]=r=>a.attachment.date=r),format:"dd/MM/Y",teleport:"#date",teleportCenter:!0},null,8,["modelValue"])]),n("div",null,[t(d,{for:"transaction_id"},{default:e(()=>[l("Transaction ID")]),_:1}),t(h,{type:"text",name:"transaction_id",id:"transaction_id",modelValue:a.attachment.transaction_id,"onUpdate:modelValue":s[9]||(s[9]=r=>a.attachment.transaction_id=r),autocomplete:"off"},null,8,["modelValue"])]),n("div",null,[t(d,null,{default:e(()=>[l("Proof of Payment ( "),re,l(" )")]),_:1}),n("div",se,[n("div",ne,[n("label",ie,[de,n("input",{type:"file",ref:"file_input",class:j(["focus:ring-0 border rounded-md block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:border-0 file:text-sm file:font-semibold file:bg-gray-200 file:text-gray-700 focus:outline-none",a.errors.proof_of_payment?"border-red-300":"border-gray-300"]),onChange:s[10]||(s[10]=(...r)=>a.uploadFile&&a.uploadFile(...r))},null,34)])])])]),n("div",null,[t(d,{for:"remark"},{default:e(()=>[l("Remark")]),_:1}),t(M,{type:"text",name:"remark",id:"remark",modelValue:a.attachment.remark,"onUpdate:modelValue":s[11]||(s[11]=r=>a.attachment.remark=r),autocomplete:"off"},null,8,["modelValue"])])])]),footer:e(()=>[t(c,{variant:"outline",onClick:s[12]||(s[12]=r=>a.show.add_attachment=!1)},{default:e(()=>[l("Cancel")]),_:1}),t(c,{onClick:a.addAttachment},{default:e(()=>[l("Add")]),_:1},8,["onClick"])]),_:1},8,["open"])]),_:1})],64)}}});export{nt as default};
