import{Fragment as Q,computed as I,defineComponent as B,h as H,inject as V,provide as A,ref as T,watchEffect as _}from"vue";import{match as M}from"../../utils/match.js";import{render as R,Features as $}from"../../utils/render.js";import{useId as F}from"../../hooks/use-id.js";import{Keys as C}from"../../keyboard.js";import{getFocusableElements as re,Focus as D,focusIn as k,isFocusableElement as le,FocusableMode as ae}from"../../utils/focus-management.js";import{dom as r}from"../../utils/dom.js";import{useOpenClosedProvider as ue,State as j,useOpenClosed as X}from"../../internal/open-closed.js";import{useResolveButtonType as ie}from"../../hooks/use-resolve-button-type.js";import{useOutsideClick as se}from"../../hooks/use-outside-click.js";import{getOwnerDocument as G}from"../../utils/owner.js";import{useEventListener as Y}from"../../hooks/use-event-listener.js";import{Hidden as q,Features as U}from"../../internal/hidden.js";import{useTabDirection as Z,Direction as L}from"../../hooks/use-tab-direction.js";import"../../utils/micro-task.js";var pe=(v=>(v[v.Open=0]="Open",v[v.Closed=1]="Closed",v))(pe||{});let ee=Symbol("PopoverContext");function N(d){let b=V(ee,null);if(b===null){let v=new Error(`<${d} /> is missing a parent <${ve.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(v,N),v}return b}let te=Symbol("PopoverGroupContext");function oe(){return V(te,null)}let ne=Symbol("PopoverPanelContext");function fe(){return V(ne,null)}let ve=B({name:"Popover",props:{as:{type:[Object,String],default:"div"}},setup(d,{slots:b,attrs:v,expose:E}){var m;let o=`headlessui-popover-button-${F()}`,e=`headlessui-popover-panel-${F()}`,p=T(null);E({el:p,$el:p});let l=T(1),P=T(null),y=T(null),g=T(null),s=T(null),f=I(()=>G(p)),h=I(()=>{if(!r(P)||!r(s))return!1;for(let n of document.querySelectorAll("body > *"))if(Number(n==null?void 0:n.contains(r(P)))^Number(n==null?void 0:n.contains(r(s))))return!0;return!1}),c={popoverState:l,buttonId:o,panelId:e,panel:s,button:P,isPortalled:h,beforePanelSentinel:y,afterPanelSentinel:g,togglePopover(){l.value=M(l.value,{[0]:1,[1]:0})},closePopover(){l.value!==1&&(l.value=1)},close(n){c.closePopover();let u=(()=>n?n instanceof HTMLElement?n:n.value instanceof HTMLElement?r(n):r(c.button):r(c.button))();u==null||u.focus()}};A(ee,c),ue(I(()=>M(l.value,{[0]:j.Open,[1]:j.Closed})));let O={buttonId:o,panelId:e,close(){c.closePopover()}},t=oe(),a=t==null?void 0:t.registerPopover;function i(){var n,u,S,W;return(W=t==null?void 0:t.isFocusWithinPopoverGroup())!=null?W:((n=f.value)==null?void 0:n.activeElement)&&(((u=r(P))==null?void 0:u.contains(f.value.activeElement))||((S=r(s))==null?void 0:S.contains(f.value.activeElement)))}return _(()=>a==null?void 0:a(O)),Y((m=f.value)==null?void 0:m.defaultView,"focus",n=>{var u,S;l.value===0&&(i()||!P||!s||(u=r(c.beforePanelSentinel))!=null&&u.contains(n.target)||(S=r(c.afterPanelSentinel))!=null&&S.contains(n.target)||c.closePopover())},!0),se([P,s],(n,u)=>{var S;l.value===0&&(c.closePopover(),le(u,ae.Loose)||(n.preventDefault(),(S=r(P))==null||S.focus()))}),()=>{let n={open:l.value===0,close:c.close};return R({props:{...d,ref:p},slot:n,slots:b,attrs:v,name:"Popover"})}}}),we=B({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(d,{attrs:b,slots:v,expose:E}){let o=N("PopoverButton"),e=I(()=>G(o.button));E({el:o.button,$el:o.button});let p=oe(),l=p==null?void 0:p.closeOthers,P=fe(),y=P===null?!1:P===o.panelId,g=T(null),s=`headlessui-focus-sentinel-${F()}`;y||_(()=>{o.button.value=g.value});let f=ie(I(()=>({as:d.as,type:b.type})),g);function h(t){var a,i,m,n,u;if(y){if(o.popoverState.value===1)return;switch(t.key){case C.Space:case C.Enter:t.preventDefault(),(i=(a=t.target).click)==null||i.call(a),o.closePopover(),(m=r(o.button))==null||m.focus();break}}else switch(t.key){case C.Space:case C.Enter:t.preventDefault(),t.stopPropagation(),o.popoverState.value===1&&(l==null||l(o.buttonId)),o.togglePopover();break;case C.Escape:if(o.popoverState.value!==0)return l==null?void 0:l(o.buttonId);if(!r(o.button)||((n=e.value)==null?void 0:n.activeElement)&&!((u=r(o.button))!=null&&u.contains(e.value.activeElement)))return;t.preventDefault(),t.stopPropagation(),o.closePopover();break}}function c(t){y||t.key===C.Space&&t.preventDefault()}function O(t){var a,i;d.disabled||(y?(o.closePopover(),(a=r(o.button))==null||a.focus()):(t.preventDefault(),t.stopPropagation(),o.popoverState.value===1&&(l==null||l(o.buttonId)),(i=r(o.button))==null||i.focus(),o.togglePopover()))}return()=>{let t=o.popoverState.value===0,a={open:t},i=y?{ref:g,type:f.value,onKeydown:h,onClick:O}:{ref:g,id:o.buttonId,type:f.value,"aria-expanded":d.disabled?void 0:o.popoverState.value===0,"aria-controls":r(o.panel)?o.panelId:void 0,disabled:d.disabled?!0:void 0,onKeydown:h,onKeyup:c,onClick:O},m=Z();function n(){let u=r(o.panel);if(!u)return;function S(){M(m.value,{[L.Forwards]:()=>k(u,D.First),[L.Backwards]:()=>k(u,D.Last)})}S()}return H(Q,[R({props:{...b,...d,...i},slot:a,attrs:b,slots:v,name:"PopoverButton"}),t&&!y&&o.isPortalled.value&&H(q,{id:s,features:U.Focusable,as:"button",type:"button",onFocus:n})])}}}),Be=B({name:"PopoverOverlay",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(d,{attrs:b,slots:v}){let E=N("PopoverOverlay"),o=`headlessui-popover-overlay-${F()}`,e=X(),p=I(()=>e!==null?e.value===j.Open:E.popoverState.value===0);function l(){E.closePopover()}return()=>{let P={open:E.popoverState.value===0};return R({props:{...d,...{id:o,"aria-hidden":!0,onClick:l}},slot:P,attrs:b,slots:v,features:$.RenderStrategy|$.Static,visible:p.value,name:"PopoverOverlay"})}}}),He=B({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1}},inheritAttrs:!1,setup(d,{attrs:b,slots:v,expose:E}){var O;let{focus:o}=d,e=N("PopoverPanel"),p=I(()=>G(e.panel)),l=`headlessui-focus-sentinel-before-${F()}`,P=`headlessui-focus-sentinel-after-${F()}`;E({el:e.panel,$el:e.panel}),A(ne,e.panelId),_(()=>{var a,i;if(!o||e.popoverState.value!==0||!e.panel)return;let t=(a=p.value)==null?void 0:a.activeElement;(i=r(e.panel))!=null&&i.contains(t)||k(r(e.panel),D.First)}),Y((O=p.value)==null?void 0:O.defaultView,"focus",()=>{var a,i,m,n,u,S;if(!o||e.popoverState.value!==0||!r(e.panel))return;let t=(a=p==null?void 0:p.value)==null?void 0:a.activeElement;t&&(((i=r(e.panel))==null?void 0:i.contains(t))||((n=(m=r(e.beforePanelSentinel))==null?void 0:m.contains)==null?void 0:n.call(m,t))||((S=(u=r(e.afterPanelSentinel))==null?void 0:u.contains)==null?void 0:S.call(u,t)))||e.closePopover()},!0);let y=X(),g=I(()=>y!==null?y.value===j.Open:e.popoverState.value===0);function s(t){var a,i;switch(t.key){case C.Escape:if(e.popoverState.value!==0||!r(e.panel)||p.value&&!((a=r(e.panel))!=null&&a.contains(p.value.activeElement)))return;t.preventDefault(),t.stopPropagation(),e.closePopover(),(i=r(e.button))==null||i.focus();break}}let f=Z();function h(){let t=r(e.panel);if(!t)return;function a(){M(f.value,{[L.Forwards]:()=>{k(t,D.First)},[L.Backwards]:()=>{var i;(i=r(e.button))==null||i.focus({preventScroll:!0})}})}a()}function c(){let t=r(e.panel);if(!t)return;function a(){M(f.value,{[L.Forwards]:()=>{var K,z;let i=r(e.button),m=r(e.panel);if(!i)return;let n=re(),u=n.indexOf(i),S=n.slice(0,u+1),x=[...n.slice(u+1),...S];for(let w of x.slice())if(((z=(K=w==null?void 0:w.id)==null?void 0:K.startsWith)==null?void 0:z.call(K,"headlessui-focus-sentinel-"))||(m==null?void 0:m.contains(w))){let J=x.indexOf(w);J!==-1&&x.splice(J,1)}k(x,D.First,!1)},[L.Backwards]:()=>k(t,D.Last)})}a()}return()=>{let t={open:e.popoverState.value===0,close:e.close},a={ref:e.panel,id:e.panelId,onKeydown:s,tabIndex:-1};return H(Q,[g.value&&e.isPortalled.value&&H(q,{id:l,ref:e.beforePanelSentinel,features:U.Focusable,as:"button",type:"button",onFocus:h}),R({props:{...b,...d,...a},slot:t,attrs:b,slots:v,features:$.RenderStrategy|$.Static,visible:g.value,name:"PopoverPanel"}),g.value&&e.isPortalled.value&&H(q,{id:P,ref:e.afterPanelSentinel,features:U.Focusable,as:"button",type:"button",onFocus:c})])}}}),Me=B({name:"PopoverGroup",props:{as:{type:[Object,String],default:"div"}},setup(d,{attrs:b,slots:v,expose:E}){let o=T(null),e=T([]),p=I(()=>G(o));E({el:o,$el:o});function l(s){let f=e.value.indexOf(s);f!==-1&&e.value.splice(f,1)}function P(s){return e.value.push(s),()=>{l(s)}}function y(){var h;let s=p.value;if(!s)return!1;let f=s.activeElement;return(h=r(o))!=null&&h.contains(f)?!0:e.value.some(c=>{var O,t;return((O=s.getElementById(c.buttonId))==null?void 0:O.contains(f))||((t=s.getElementById(c.panelId))==null?void 0:t.contains(f))})}function g(s){for(let f of e.value)f.buttonId!==s&&f.close()}return A(te,{registerPopover:P,unregisterPopover:l,isFocusWithinPopoverGroup:y,closeOthers:g}),()=>R({props:{...d,...{ref:o}},slot:{},attrs:b,slots:v,name:"PopoverGroup"})}});export{ve as Popover,we as PopoverButton,Me as PopoverGroup,Be as PopoverOverlay,He as PopoverPanel};
